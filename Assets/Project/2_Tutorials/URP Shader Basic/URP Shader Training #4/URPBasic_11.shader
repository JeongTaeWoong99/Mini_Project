// ============================================================================
// URP ê¸°ë³¸ ì…°ì´ë” - Camera Vectorë¥¼ í™œìš©í•œ Rim Light
// ============================================================================
//
// ğŸ“– í•™ìŠµ ë‚´ìš© (PDF 52-53p) :
// - Camera Vector (View Direction) ê³„ì‚°
// - ë…¸ë©€ê³¼ View Directionì˜ ë‚´ì ìœ¼ë¡œ Rim íš¨ê³¼ ê³„ì‚°
// - HDR Colorë¡œ Bloom íš¨ê³¼ ì—°ì¶œ ê°€ëŠ¥
//
// ğŸ’¡ Rim Light ì›ë¦¬ :
// - dot(ViewDir, Normal) = ì¹´ë©”ë¼ê°€ ë°”ë¼ë³´ëŠ” ë°©í–¥ê³¼ ë©´ì˜ ê°ë„
// - ì •ë©´(dot=1) â†’ rim=0 (ì–´ë‘ì›€)
// - ì¸¡ë©´(dot=0) â†’ rim=1 (ë°ìŒ) = ê°€ì¥ìë¦¬ ë°œê´‘!
// - rim = 1 - pow(dot, power)
//
// ============================================================================

Shader "URPTraining/URPBasic_11"
{
    Properties
    {
        [Header(Rim Light Settings)]
        _RimPower("Rim Power (ë²”ìœ„ ì¡°ì ˆ)", Range(0.01, 1))   = 0.1
        _RimInten("Rim Intensity (ê°•ë„)", Range(0.01, 100)) = 1
        [HDR] _RimColor("Rim Color (HDR ì§€ì›)", Color) = (1, 1, 1, 1)

        [Header(Base Settings)]
        _BaseColor("Base Color", Color) = (0.5, 0.5, 0.5, 1)
    }

    SubShader
    {
        Tags
        {
            "RenderPipeline" = "UniversalPipeline"
            "RenderType"     = "Opaque"
            "Queue"          = "Geometry"
        }

        Pass
        {
            Name "Universal Forward"
            Tags { "LightMode" = "UniversalForward" }

            HLSLPROGRAM

            #pragma target   3.5
            #pragma vertex   vert
            #pragma fragment frag

            #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Lighting.hlsl"

            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            // [CBUFFER] : SRP Batcher ì§€ì›
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            CBUFFER_START(UnityPerMaterial)
                float  _RimPower;
                float  _RimInten;
                half4  _RimColor;
                half4  _BaseColor;
            CBUFFER_END

            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            // [VertexInput]
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            struct VertexInput
            {
                float4 vertex : POSITION;
                float3 normal : NORMAL;
            };

            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            // [VertexOutput]
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            struct VertexOutput
            {
                float4 vertex                  : SV_POSITION;
                float3 normal                  : NORMAL;
                float3 worldSpaceViewDirection : TEXCOORD0;  // ì¹´ë©”ë¼ ë°©í–¥ ë²¡í„°
            };

            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            // [ë²„í…ìŠ¤ ì…°ì´ë”]
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            VertexOutput vert(VertexInput v)
            {
                VertexOutput o;

                // ë¡œì»¬ â†’ í´ë¦½ ì¢Œí‘œ
                o.vertex = TransformObjectToHClip(v.vertex.xyz);

                // ë¡œì»¬ â†’ ì›”ë“œ ë…¸ë©€
                o.normal = TransformObjectToWorldNormal(v.normal);

                // â˜… ì¹´ë©”ë¼ ë°©í–¥ ë²¡í„° ê³„ì‚° â˜…
                // = ì¹´ë©”ë¼ ìœ„ì¹˜ - ë²„í…ìŠ¤ ì›”ë“œ ìœ„ì¹˜
                // = ë²„í…ìŠ¤ì—ì„œ ì¹´ë©”ë¼ë¥¼ í–¥í•˜ëŠ” ë°©í–¥
                float3 worldPos = TransformObjectToWorld(v.vertex.xyz);
                o.worldSpaceViewDirection = normalize(_WorldSpaceCameraPos.xyz - worldPos);

                return o;
            }

            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            // [í”½ì…€ ì…°ì´ë”] : Rim Light ì ìš©
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            half4 frag(VertexOutput i) : SV_Target
            {
                // ë¼ì´íŠ¸ ì •ë³´
                float3 lightDir = _MainLightPosition.xyz;

                // ê¸°ë³¸ ìƒ‰ìƒ
                float4 color = _BaseColor;

                // Ambient (SH ë¼ì´íŠ¸ í”„ë¡œë¸Œ)
                half3 ambient = SampleSH(i.normal);

                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                // â˜… Rim Light ê³„ì‚° â˜…
                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                // 1. View Directionê³¼ Normalì˜ ë‚´ì 
                //    - ì •ë©´(ê°™ì€ ë°©í–¥) = 1
                //    - ì¸¡ë©´(90ë„)     = 0
                half face = saturate(dot(i.worldSpaceViewDirection, i.normal));

                // 2. Rim ê°’ ê³„ì‚° : 1 - pow(face, power)
                //    - ì •ë©´ : 1 - 1 = 0 (ì–´ë‘ì›€)
                //    - ì¸¡ë©´ : 1 - 0 = 1 (ë°ìŒ) â†’ ê°€ì¥ìë¦¬ ë°œê´‘!
                half3 rim = 1.0 - pow(face, _RimPower);

                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                // Diffuse (Lambert ë¼ì´íŒ…)
                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                float NdotL = saturate(dot(i.normal, lightDir));
                color.rgb *= NdotL * _MainLightColor.rgb + ambient;

                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                // Emissive (Rim Light ì¶”ê°€)
                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                color.rgb += rim * _RimInten * _RimColor.rgb;

                return color;
            }

            ENDHLSL
        }
    }
}

// ============================================================================
// ğŸ“ Rim Light ì›ë¦¬ ìƒì„¸
// ============================================================================
//
//            ì¹´ë©”ë¼
//              â”‚
//              â–¼
//         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
//        /â”‚        â”‚\      â† ì¸¡ë©´ (dotâ‰ˆ0) â†’ rim=1 (ë°ìŒ!)
//       / â”‚        â”‚ \
//      â”‚  â”‚ ì •ë©´   â”‚  â”‚
//      â”‚  â”‚(dot=1) â”‚  â”‚    â† ì •ë©´ (dot=1) â†’ rim=0 (ì–´ë‘ì›€)
//       \ â”‚        â”‚ /
//        \â”‚        â”‚/      â† ì¸¡ë©´ (dotâ‰ˆ0) â†’ rim=1 (ë°ìŒ!)
//         â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
//
// face = dot(ViewDir, Normal)
// rim  = 1 - pow(face, power)
//
// Powerê°€ ì‘ì„ìˆ˜ë¡ â†’ Rim ì˜ì—­ì´ ë„“ì–´ì§
// Powerê°€ í´ìˆ˜ë¡   â†’ Rim ì˜ì—­ì´ ì¢ì•„ì§ (ë‚ ì¹´ë¡œìš´ í…Œë‘ë¦¬)
//
// ============================================================================
// ğŸ“ HDR Color í™œìš©
// ============================================================================
//
// [HDR] ì†ì„±ì„ ì‚¬ìš©í•˜ë©´ ìƒ‰ìƒ ê°’ì´ 1ì„ ì´ˆê³¼í•  ìˆ˜ ìˆìŒ
// â†’ Post Processingì˜ Bloom íš¨ê³¼ì™€ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ë°œê´‘ íš¨ê³¼!
//
// ============================================================================

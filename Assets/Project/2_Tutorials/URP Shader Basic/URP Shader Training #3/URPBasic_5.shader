// ============================================================================
// URP ê¸°ë³¸ ì…°ì´ë” #5 - ë‘ í…ìŠ¤ì²˜ ë¸”ë Œë”© (Lerp + Mask)
// ============================================================================
//
// âš ï¸ ìˆ˜ì • ì•ˆë‚´ :
// PDF 5ë²ˆ ì…°ì´ë”ê°€ êµ¬ ë²„ì „(ì•½ 4ë…„ ì „) ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì–´ ìˆì–´ì„œ,
// ìµœì‹  URP ìŠ¤íƒ€ì¼ë¡œ ìˆ˜ì •í•œ ë²„ì „ì…ë‹ˆë‹¤.
//
// ì£¼ìš” ë³€ê²½ ì‚¬í•­ :
// 1. pragma ì§€ì‹œë¬¸ í˜„ëŒ€í™” (#pragma prefer_hlslcc gles ë“± ì œê±°)
// 2. TEXTURE2D / SAMPLER ë§¤í¬ë¡œ ì‚¬ìš©
// 3. SAMPLE_TEXTURE2D ë§¤í¬ë¡œ ì‚¬ìš©
// 4. CBUFFER ì¶”ê°€ (SRP Batcher ì§€ì›)
//
// ğŸ“ ì´ ì…°ì´ë”ì˜ íŠ¹ì§• :
// - ë‘ ê°œì˜ í…ìŠ¤ì²˜ë¥¼ ë¸”ë Œë”©
// - [ê¸°ë³¸] Splatting ëª¨ë“œ : UV.x ê¸°ì¤€ìœ¼ë¡œ ë¸”ë Œë”© (ì™¼ìª½â†’í…ìŠ¤ì²˜1, ì˜¤ë¥¸ìª½â†’í…ìŠ¤ì²˜2)
// - [ì„ íƒ] Mask ëª¨ë“œ : ë§ˆìŠ¤í¬ í…ìŠ¤ì²˜ì˜ Rì±„ë„ ê¸°ì¤€ìœ¼ë¡œ ë¸”ë Œë”©
// - lerp(A, B, t) : t=0ì´ë©´ A, t=1ì´ë©´ B
// - ê° í…ìŠ¤ì²˜ì— ë…ë¦½ì ì¸ Tiling/Offset ì ìš© ê°€ëŠ¥
//
// ============================================================================

// [ì…°ì´ë” ê²½ë¡œ] : Materialì—ì„œ ì…°ì´ë” ì„ íƒ ì‹œ "URPTraining" í´ë” ì•ˆì— "URPBasic_5"ë¡œ í‘œì‹œë¨
Shader "URPTraining/URPBasic_5"
{
    // [Properties] : Material Inspectorì— ë…¸ì¶œí•  ë³€ìˆ˜ë“¤
    Properties
    {
        // â”€â”€â”€ í…ìŠ¤ì²˜ ì„¤ì • â”€â”€â”€
        _MainTex("Texture 01 (RGB)", 2D)   = "white" {}  // ì²« ë²ˆì§¸ í…ìŠ¤ì²˜
        _MainTex02("Texture 02 (RGB)", 2D) = "white" {}  // ë‘ ë²ˆì§¸ í…ìŠ¤ì²˜

        // â”€â”€â”€ ë§ˆìŠ¤í¬ ë¸”ë Œë”© ì„¤ì • â”€â”€â”€
        [Toggle(_USE_MASK)] _UseMask("Use Mask Blending", Float) = 0  // ë§ˆìŠ¤í¬ ë¸”ë Œë”© On/Off
        _MaskTex("Mask Texture", 2D) = "white" {}                     // ë§ˆìŠ¤í¬ í…ìŠ¤ì²˜ (Rì±„ë„ ì‚¬ìš©)
    }

    // [SubShader] : ì‹¤ì œ ë Œë”ë§ ë°©ë²•ì„ ì •ì˜í•˜ëŠ” ë¸”ë¡
    SubShader
    {
        // [Tags] : ë Œë”ë§ ì„¤ì •
        Tags
        {
            "RenderPipeline" = "UniversalPipeline"  // URP ì‚¬ìš© ì„ ì–¸
            "RenderType"     = "Opaque"             // ë¶ˆíˆ¬ëª… ì˜¤ë¸Œì íŠ¸
            "Queue"          = "Geometry"           // ë Œë”ë§ ìˆœì„œ (ê¸°ë³¸ê°’ 2000)
        }

        // [Pass] : í•œ ë²ˆì˜ ë“œë¡œìš°ì½œë¡œ ì‹¤í–‰ë˜ëŠ” ë Œë”ë§ ë‹¨ìœ„
        Pass
        {
            Name "Universal Forward"
            Tags { "LightMode" = "UniversalForward" }

            // ====== HLSL ì½”ë“œ ì‹œì‘ ======
            HLSLPROGRAM

            // [pragma] : ì»´íŒŒì¼ëŸ¬ ì§€ì‹œë¬¸
            #pragma target   3.5     // Shader Model 3.5 ì´ìƒ
            #pragma vertex   vert    // ë²„í…ìŠ¤ ì…°ì´ë” í•¨ìˆ˜ëª… ì§€ì •
            #pragma fragment frag    // í”½ì…€ ì…°ì´ë” í•¨ìˆ˜ëª… ì§€ì •

            // [shader_feature] : í‚¤ì›Œë“œ ê¸°ë°˜ ë¶„ê¸° (Materialë§ˆë‹¤ ë‹¤ë¥¸ ì…°ì´ë” ë³€í˜• ìƒì„±)
            #pragma shader_feature_local _USE_MASK

            // [include] : URP ë¼ì´íŒ… í•¨ìˆ˜ë“¤ ê°€ì ¸ì˜¤ê¸°
            #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Lighting.hlsl"

            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            // [ë³€ìˆ˜ ì„ ì–¸] : Propertiesì—ì„œ ì„ ì–¸í•œ ë³€ìˆ˜ë¥¼ HLSLì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì„ ì–¸
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

            // í…ìŠ¤ì²˜ & ìƒ˜í”ŒëŸ¬ (CBUFFER ë°–ì— ì„ ì–¸!)
            TEXTURE2D(_MainTex);              // í…ìŠ¤ì²˜ ì˜¤ë¸Œì íŠ¸ 1 (ë§¤í¬ë¡œ ì‚¬ìš©)
            TEXTURE2D(_MainTex02);            // í…ìŠ¤ì²˜ ì˜¤ë¸Œì íŠ¸ 2 (ë§¤í¬ë¡œ ì‚¬ìš©)
            TEXTURE2D(_MaskTex);              // ë§ˆìŠ¤í¬ í…ìŠ¤ì²˜ (ë§¤í¬ë¡œ ì‚¬ìš©)
            SAMPLER(sampler_MainTex);         // í…ìŠ¤ì²˜ ìƒ˜í”ŒëŸ¬ (ëª¨ë“  í…ìŠ¤ì²˜ê°€ ê³µìœ )

            // CBUFFER : SRP Batcher ì§€ì›ì„ ìœ„í•´ í•„ìˆ˜!
            // ê°™ì€ CBUFFERë¥¼ ì‚¬ìš©í•˜ëŠ” ë¨¸í‹°ë¦¬ì–¼ë“¤ì€ ë°°ì¹­ë˜ì–´ ì„±ëŠ¥ í–¥ìƒ
            CBUFFER_START(UnityPerMaterial)
                float4 _MainTex_ST;           // í…ìŠ¤ì²˜1 Tiling(xy) & Offset(zw)
                float4 _MainTex02_ST;         // í…ìŠ¤ì²˜2 Tiling(xy) & Offset(zw)
                float4 _MaskTex_ST;           // ë§ˆìŠ¤í¬ í…ìŠ¤ì²˜ Tiling(xy) & Offset(zw)
            CBUFFER_END

            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            // [VertexInput] : GPUê°€ ë©”ì‹œì—ì„œ ì½ì–´ì˜¬ ë°ì´í„°
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            struct VertexInput
            {
                float4 vertex : POSITION;   // ë²„í…ìŠ¤ ìœ„ì¹˜ (ë¡œì»¬ ì¢Œí‘œ)
                float2 uv     : TEXCOORD0;  // UV ì¢Œí‘œ (í…ìŠ¤ì²˜ ë§¤í•‘ìš©)
            };

            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            // [VertexOutput] : ë²„í…ìŠ¤ â†’ í”½ì…€ ì…°ì´ë”ë¡œ ì „ë‹¬í•  ë°ì´í„°
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            struct VertexOutput
            {
                float4 vertex : SV_POSITION;  // í™”ë©´ìƒ ìœ„ì¹˜ (í´ë¦½ ì¢Œí‘œ)
                float2 uv     : TEXCOORD0;    // UV ì¢Œí‘œ (í…ìŠ¤ì²˜1ìš©)
                float2 uv2    : TEXCOORD1;    // UV ì¢Œí‘œ (í…ìŠ¤ì²˜2ìš©)
            };

            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            // [ë²„í…ìŠ¤ ì…°ì´ë”] : ê° ì •ì ë§ˆë‹¤ ì‹¤í–‰
            // ì—­í•  : 3D ì¢Œí‘œ â†’ 2D í™”ë©´ ì¢Œí‘œë¡œ ë³€í™˜
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            VertexOutput vert(VertexInput v)
            {
                VertexOutput o;

                // ë¡œì»¬ ì¢Œí‘œ â†’ í´ë¦½ ì¢Œí‘œ ë³€í™˜ (MVP í–‰ë ¬ ì ìš©)
                o.vertex = TransformObjectToHClip(v.vertex.xyz);

                // UV ë³€í™˜ : ê° í…ìŠ¤ì²˜ë³„ë¡œ ë…ë¦½ì ì¸ Tiling/Offset ì ìš©
                o.uv  = v.uv.xy * _MainTex_ST.xy   + _MainTex_ST.zw;    // í…ìŠ¤ì²˜1 UV
                o.uv2 = v.uv.xy * _MainTex02_ST.xy + _MainTex02_ST.zw;  // í…ìŠ¤ì²˜2 UV

                return o;
            }

            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            // [í”½ì…€(í”„ë˜ê·¸ë¨¼íŠ¸) ì…°ì´ë”] : ê° í”½ì…€ë§ˆë‹¤ ì‹¤í–‰
            // ì—­í•  : ë‘ í…ìŠ¤ì²˜ë¥¼ ë¸”ë Œë”©
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            half4 frag(VertexOutput i) : SV_Target
            {
                // ë‘ í…ìŠ¤ì²˜ ìƒ˜í”Œë§
                float4 tex01 = SAMPLE_TEXTURE2D(_MainTex,   sampler_MainTex, i.uv);    // í…ìŠ¤ì²˜1 ìƒ‰ìƒ
                float4 tex02 = SAMPLE_TEXTURE2D(_MainTex02, sampler_MainTex, i.uv2);   // í…ìŠ¤ì²˜2 ìƒ‰ìƒ

                float4 color;

                // â”€â”€â”€ ë§ˆìŠ¤í¬ ë¸”ë Œë”© ëª¨ë“œ â”€â”€â”€
                // ë§ˆìŠ¤í¬ í…ìŠ¤ì²˜ì˜ Rì±„ë„ì„ ì‚¬ìš©í•˜ì—¬ ë¸”ë Œë”©
                // R=0 â†’ í…ìŠ¤ì²˜1, R=1 â†’ í…ìŠ¤ì²˜2
                #if defined(_USE_MASK)
                    // ë§ˆìŠ¤í¬ í…ìŠ¤ì²˜ ìƒ˜í”Œë§ (í…ìŠ¤ì²˜1ê³¼ ë™ì¼í•œ UV ì‚¬ìš©)
                    float4 mask = SAMPLE_TEXTURE2D(_MaskTex, sampler_MainTex, i.uv);

                    // lerpë¡œ ë§ˆìŠ¤í¬ Rì±„ë„ ê¸°ì¤€ ë¸”ë Œë”©
                    color = lerp(tex01, tex02, mask.r);

                    // â†“ Add ë°©ì‹ (ê° ì±„ë„ ë¶„ë¦¬ ë¸”ë Œë”©) - ì£¼ì„ í•´ì œí•˜ì—¬ ì‚¬ìš© ê°€ëŠ¥ â†“
                    // RGBA ë§ˆìŠ¤í¬ì˜ ê° ì±„ë„ì´ ì¤‘ë³µë˜ì§€ ì•Šì•„ì•¼ ê¹”ë”í•˜ê²Œ ë‚˜ì˜´
                    // color = tex01 * mask.r + tex02 * mask.g;

                // â”€â”€â”€ ê¸°ë³¸ Splatting ëª¨ë“œ â”€â”€â”€
                // UV.xë¥¼ ì‚¬ìš©í•˜ì—¬ ë¸”ë Œë”© (ì™¼ìª½â†’í…ìŠ¤ì²˜1, ì˜¤ë¥¸ìª½â†’í…ìŠ¤ì²˜2)
                #else
                    // lerp(A, B, t) : Aì™€ Bë¥¼ t ë¹„ìœ¨ë¡œ ë³´ê°„
                    // t = i.uv.x : ì™¼ìª½(0)ì€ tex01, ì˜¤ë¥¸ìª½(1)ì€ tex02
                    color = lerp(tex01, tex02, i.uv.x);
                #endif

                return color;
            }

            // ====== HLSL ì½”ë“œ ë ======
            ENDHLSL
        }
    }
}

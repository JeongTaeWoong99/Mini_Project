// ============================================================================
// URP ê¸°ë³¸ ì…°ì´ë” #2 - Alpha Cutout (ì•ŒíŒŒ ì»·ì•„ì›ƒ) ì…°ì´ë”
// ============================================================================
//
// âš ï¸ ìˆ˜ì • ì•ˆë‚´ :
// PDF 2ë²ˆ ì…°ì´ë”ê°€ êµ¬ ë²„ì „(ì•½ 4ë…„ ì „) ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì–´ ìˆì–´ì„œ,
// ìµœì‹  URP ìŠ¤íƒ€ì¼ë¡œ ìˆ˜ì •í•œ ë²„ì „ì…ë‹ˆë‹¤.
//
// ì£¼ìš” ë³€ê²½ ì‚¬í•­ :
// 1. pragma ì§€ì‹œë¬¸ í˜„ëŒ€í™” (#pragma prefer_hlslcc gles ë“± ì œê±°)
// 2. TEXTURE2D / SAMPLER ë§¤í¬ë¡œ ì‚¬ìš©
// 3. SAMPLE_TEXTURE2D ë§¤í¬ë¡œ ì‚¬ìš©
// 4. CBUFFER ì¶”ê°€ (SRP Batcher ì§€ì›)
//
// ğŸ“ ì´ ì…°ì´ë”ì˜ íŠ¹ì§• :
// - Alpha Cutout : ì•ŒíŒŒê°’ì´ íŠ¹ì • ì„ê³„ê°’(_Alpha) ì´í•˜ë©´ í”½ì…€ì„ ë²„ë¦¼ (clip)
// - ë‚˜ë­‡ì, í’€, ì² ë§ ë“± "ëš«ë¦° ë¶€ë¶„"ì´ ìˆëŠ” í…ìŠ¤ì²˜ì— ì‚¬ìš©
// - ë°˜íˆ¬ëª…ì´ ì•„ë‹ˆë¼ "ì™„ì „ íˆ¬ëª… or ì™„ì „ ë¶ˆíˆ¬ëª…" ë°©ì‹
//
// ============================================================================

// [ì…°ì´ë” ê²½ë¡œ] : Materialì—ì„œ ì…°ì´ë” ì„ íƒ ì‹œ "URPTraining" í´ë” ì•ˆì— "URPBasic_2"ìœ¼ë¡œ í‘œì‹œë¨
Shader "URPTraining/URPBasic_2"
{
    // [Properties] : Material Inspectorì— ë…¸ì¶œí•  ë³€ìˆ˜ë“¤
    Properties
    {
        _TintColor("Tint Color"  , Color)       = (1, 1, 1, 1)  // í‹´íŠ¸ ìƒ‰ìƒ (RGBA)
        _Intensity("Intensity"   , Range(0, 1)) = 0.5              // ê°•ë„ ìŠ¬ë¼ì´ë” (0~1)
        _MainTex("Main Texture"  , 2D)          = "white" {}       // ë©”ì¸ í…ìŠ¤ì²˜ (ê¸°ë³¸ê°’ : í°ìƒ‰)
        _Alpha("Alpha Cutoff"    , Range(0, 1)) = 0.5              // ì•ŒíŒŒ ì»·ì˜¤í”„ ì„ê³„ê°’
    }

    // [SubShader] : ì‹¤ì œ ë Œë”ë§ ë°©ë²•ì„ ì •ì˜í•˜ëŠ” ë¸”ë¡
    SubShader
    {
        // [Tags] : ë Œë”ë§ ì„¤ì •
        Tags
        {
            "RenderPipeline" = "UniversalPipeline"  // URP ì‚¬ìš© ì„ ì–¸
            "RenderType"     = "TransparentCutout"  // ì•ŒíŒŒ ì»·ì•„ì›ƒ íƒ€ì… (Opaqueì™€ ë‹¤ë¦„!)
            "Queue"          = "AlphaTest"          // ë Œë”ë§ ìˆœì„œ (2450) - Geometry(2000) ì´í›„
        }

        // [Pass] : í•œ ë²ˆì˜ ë“œë¡œìš°ì½œë¡œ ì‹¤í–‰ë˜ëŠ” ë Œë”ë§ ë‹¨ìœ„
        Pass
        {
            Name "Universal Forward"
            Tags { "LightMode" = "UniversalForward" }

            // ====== HLSL ì½”ë“œ ì‹œì‘ ======
            HLSLPROGRAM

            // [pragma] : ì»´íŒŒì¼ëŸ¬ ì§€ì‹œë¬¸
            #pragma target   3.5                    // Shader Model 3.5 ì´ìƒ
            #pragma vertex   vert                   // ë²„í…ìŠ¤ ì…°ì´ë” í•¨ìˆ˜ëª… ì§€ì •
            #pragma fragment frag                   // í”½ì…€ ì…°ì´ë” í•¨ìˆ˜ëª… ì§€ì •

            // [include] : URP ë¼ì´íŒ… í•¨ìˆ˜ë“¤ ê°€ì ¸ì˜¤ê¸°
            #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Lighting.hlsl"

            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            // [ë³€ìˆ˜ ì„ ì–¸] : Propertiesì—ì„œ ì„ ì–¸í•œ ë³€ìˆ˜ë¥¼ HLSLì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì„ ì–¸
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

            // í…ìŠ¤ì²˜ & ìƒ˜í”ŒëŸ¬ (CBUFFER ë°–ì— ì„ ì–¸!)
            TEXTURE2D(_MainTex);            // í…ìŠ¤ì²˜ ì˜¤ë¸Œì íŠ¸ (ë§¤í¬ë¡œ ì‚¬ìš©)
            SAMPLER(sampler_MainTex);       // í…ìŠ¤ì²˜ ìƒ˜í”ŒëŸ¬ (ë§¤í¬ë¡œ ì‚¬ìš©)

            // CBUFFER : SRP Batcher ì§€ì›ì„ ìœ„í•´ í•„ìˆ˜!
            // ê°™ì€ CBUFFERë¥¼ ì‚¬ìš©í•˜ëŠ” ë¨¸í‹°ë¦¬ì–¼ë“¤ì€ ë°°ì¹­ë˜ì–´ ì„±ëŠ¥ í–¥ìƒ
            CBUFFER_START(UnityPerMaterial)
                half4  _TintColor;          // í‹´íŠ¸ ìƒ‰ìƒ (Propertiesì™€ ì´ë¦„ ë™ì¼!)
                float  _Intensity;          // ê°•ë„ ê°’ (Range â†’ float)
                float  _Alpha;              // ì•ŒíŒŒ ì»·ì˜¤í”„ ì„ê³„ê°’
                float4 _MainTex_ST;         // í…ìŠ¤ì²˜ Tiling(xy) & Offset(zw) - "_ST" ì ‘ë¯¸ì‚¬ í•„ìˆ˜!
            CBUFFER_END

            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            // [VertexInput] : GPUê°€ ë©”ì‹œì—ì„œ ì½ì–´ì˜¬ ë°ì´í„°
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            struct VertexInput
            {
                float4 vertex : POSITION;   // ë²„í…ìŠ¤ ìœ„ì¹˜ (ë¡œì»¬ ì¢Œí‘œ)
                float2 uv     : TEXCOORD0;  // UV ì¢Œí‘œ (í…ìŠ¤ì²˜ ë§¤í•‘ìš©)
            };

            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            // [VertexOutput] : ë²„í…ìŠ¤ â†’ í”½ì…€ ì…°ì´ë”ë¡œ ì „ë‹¬í•  ë°ì´í„°
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            struct VertexOutput
            {
                float4 vertex : SV_POSITION;  // í™”ë©´ìƒ ìœ„ì¹˜ (í´ë¦½ ì¢Œí‘œ)
                float2 uv     : TEXCOORD0;    // UV ì¢Œí‘œ (í”„ë˜ê·¸ë¨¼íŠ¸ë¡œ ì „ë‹¬)
            };

            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            // [ë²„í…ìŠ¤ ì…°ì´ë”] : ê° ì •ì ë§ˆë‹¤ ì‹¤í–‰
            // ì—­í•  : 3D ì¢Œí‘œ â†’ 2D í™”ë©´ ì¢Œí‘œë¡œ ë³€í™˜
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            VertexOutput vert(VertexInput v)
            {
                VertexOutput o;

                // ë¡œì»¬ ì¢Œí‘œ â†’ í´ë¦½ ì¢Œí‘œ ë³€í™˜ (MVP í–‰ë ¬ ì ìš©)
                o.vertex = TransformObjectToHClip(v.vertex.xyz);

                // UV ë³€í™˜ : Tiling(xy) * UV + Offset(zw)
                // Materialì˜ Tiling/Offset ê°’ì´ ì ìš©ë¨
                o.uv = v.uv.xy * _MainTex_ST.xy + _MainTex_ST.zw;

                return o;
            }

            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            // [í”½ì…€(í”„ë˜ê·¸ë¨¼íŠ¸) ì…°ì´ë”] : ê° í”½ì…€ë§ˆë‹¤ ì‹¤í–‰
            // ì—­í•  : ìµœì¢… ìƒ‰ìƒ ê²°ì • + ì•ŒíŒŒ ì»·ì•„ì›ƒ ì ìš©
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            half4 frag(VertexOutput i) : SV_Target
            {
                // í…ìŠ¤ì²˜ ìƒ˜í”Œë§ : UV ì¢Œí‘œë¡œ í…ìŠ¤ì²˜ì—ì„œ ìƒ‰ìƒ ì¶”ì¶œ (ë§¤í¬ë¡œ ì‚¬ìš©)
                float4 color = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, i.uv);

                // Rì§€GBì—ë§Œ í‹´íŠ¸ ìƒ‰ìƒê³¼ ê°•ë„ ì ìš© (ì•ŒíŒŒëŠ” ê·¸ëŒ€ë¡œ ìœ !)
                color.rgb *= _TintColor.rgb * _Intensity;

                // â˜… Alpha Cutout í•µì‹¬! â˜…
                // clip(x) : xê°€ 0 ë¯¸ë§Œì´ë©´ í•´ë‹¹ í”½ì…€ì„ ë²„ë¦¼ (ë Œë”ë§ ì•ˆ í•¨)
                // color.a - _Alpha : ì•ŒíŒŒê°’ì´ ì„ê³„ê°’ë³´ë‹¤ ì‘ìœ¼ë©´ ìŒìˆ˜ â†’ í”½ì…€ ë²„ë¦¼
                // ì˜ˆ : _Alpha = 0.5ì¼ ë•Œ, ì•ŒíŒŒê°€ 0.3ì´ë©´ â†’ 0.3 - 0.5 = -0.2 â†’ ë²„ë¦¼!
                clip(color.a - _Alpha);

                return color;
            }

            // ====== HLSL ì½”ë“œ ë ======
            ENDHLSL
        }
    }
}
